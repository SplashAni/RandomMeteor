/*
* helped coded by cally72jhb!!!!!
 * */
package random.meteor.systems.modules;

import meteordevelopment.meteorclient.events.packets.PacketEvent;
import meteordevelopment.meteorclient.systems.modules.Module;
import meteordevelopment.orbit.EventHandler;
import net.minecraft.network.packet.c2s.play.ClickSlotC2SPacket;
import net.minecraft.screen.slot.SlotActionType;
import random.meteor.Main;

import java.util.Objects;

public class ItemExploit extends Module {
    public ItemExploit() {
        super(Main.RM, "item-exploit", "all credits to cally72jhb");
    }

    private int storedSlot = -1;
    private boolean isModifying = false;

    @EventHandler
    public void onPacket(PacketEvent.Send event) {
        if (event.packet instanceof ClickSlotC2SPacket packet && !isModifying) {
            if (packet.getActionType() == SlotActionType.PICKUP) {
                storedSlot = packet.getSlot();
                event.cancel();
            } else if (packet.getActionType() == SlotActionType.PICKUP && storedSlot != -1) {
                isModifying = true;

                Objects.requireNonNull(mc.getNetworkHandler()).sendPacket(new ClickSlotC2SPacket(
                    packet.getSyncId(),
                    packet.getRevision(),
                    storedSlot,
                    packet.getSlot(),
                    SlotActionType.SWAP,
                    packet.getStack(),
                    packet.getModifiedStacks()
                ));

                isModifying = false;
                event.cancel();
            }
        }
    }
}
